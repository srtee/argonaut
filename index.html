<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="View and manage research papers with filtering, abstracts, and export options.">
    <title>Argonaut</title>
    <link rel="stylesheet" href="styles.css?v=1.0.4">
</head>
<body>
    <a href="#mainContent" class="skip-link" role="navigation">Skip to main content</a>
    <main class="container" id="mainContent" tabindex="-1">
        <h1>Argonaut</h1>
        <p class="subtitle">browser-based, JSON-stored bibliographies</p>
        <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode" type="button">
            <svg id="themeIcon" viewBox="0 0 24 24" aria-hidden="true">
                <!-- Sun icon (shown in dark mode) -->
                <g class="sun-icon" style="display: none;">
                    <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </g>
                <!-- Moon icon (shown in light mode) -->
                <g class="moon-icon">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke-width="2" fill="none"/>
                </g>
            </svg>
        </button>

        <!-- JSON Input Section -->
        <section class="input-section" id="inputSection" aria-labelledby="loadPapersHeading">
            <h2 id="loadPapersHeading">Load Papers</h2>
            <div class="input-options">
                <div class="input-option active" data-input="file">
                    <label class="input-option-label">
                        <input type="radio" name="inputMethod" value="file" checked id="inputMethodFile">
                        Upload JSON File
                    </label>
                    <div class="input-option-content" id="fileInputContent">
                        <input type="file" id="fileInput" accept=".json" class="file-input" aria-labelledby="inputMethodFile">
                    </div>
                </div>
                <div class="input-option" data-input="url">
                    <label class="input-option-label">
                        <input type="radio" name="inputMethod" value="url" id="inputMethodUrl">
                        Load from URL
                    </label>
                    <div class="input-option-content" style="display: none;">
                        <input type="text" id="urlInput" value="https://gist.githubusercontent.com/srtee/04ee671f6f27d64de800f00eb9280a21/raw/papers.json" placeholder="Enter JSON URL (e.g., GitHub Gist)" class="url-input" aria-label="Enter JSON file URL">
                        <button id="loadUrlBtn" type="button" class="secondary-btn" aria-label="Load papers from URL">Load</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Add DOI Section (always visible) -->
        <section class="add-doi-section" id="addDoiSection" aria-labelledby="addDoiHeading">
            <h2 id="addDoiHeading">Add Paper by DOI</h2>
            <div class="add-doi-inputs">
                <div class="input-group">
                    <label for="doiInput" class="input-label">DOI or URL</label>
                    <input type="text" id="doiInput" class="doi-input" placeholder="10.xxxx/xxxx or https://doi.org/10.xxxx/xxxx" aria-label="Enter DOI or URL containing DOI">
                </div>
                <div class="input-group">
                    <label for="doiKeyInput" class="input-label">Key (optional)</label>
                    <input type="text" id="doiKeyInput" class="doi-key-input" placeholder="e.g., Smith2024" aria-label="Enter optional citation key">
                </div>
                <button id="addDoiBtn" type="button" class="add-doi-btn" aria-label="Add paper from DOI">Add DOI</button>
            </div>
        </section>

        <!-- Export Buttons Section (hidden until papers are loaded) -->
        <section class="export-section" id="exportSection" style="display: none;" aria-labelledby="exportHeading">
            <h2 id="exportHeading" class="visually-hidden">Export Options</h2>
            <div class="export-buttons">
                <button id="exportJsonBtn" type="button" class="secondary-btn" aria-label="Export all papers as JSON file">Export JSON</button>
                <button id="exportBibtexAllBtn" type="button" class="secondary-btn" aria-label="Export all papers as BibTeX file">Export BibTeX (all)</button>
                <button id="exportBibtexTaggedBtn" type="button" class="secondary-btn" aria-label="Export only tagged papers as BibTeX file">Export BibTeX (only tagged)</button>
                <button id="manageTagsBtn" type="button" class="secondary-btn" aria-label="Manage all tags globally">Manage Tags</button>
                <button id="editTagsModeBtn" type="button" class="secondary-btn" aria-label="Toggle edit mode for global tag changes">Edit Tags Mode: Off</button>
                <button id="loadNewBtn" type="button" class="secondary-btn" aria-label="Reset all papers, comments, and tags">Reset All</button>
            </div>
        </section>

        <!-- Papers List Section -->
        <section class="papers-section" id="papersSection" style="display: none;" aria-live="polite">
            <div id="papersList" class="papers-list" role="list" aria-label="List of papers">
                <!-- Papers will be rendered here -->
            </div>
        </section>

        <!-- Edit Tags Modal -->
        <div id="editTagsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="editTagsModalTitle" style="display: none;">
            <div class="modal-container" role="document">
                <div class="modal-header">
                    <h2 id="editTagsModalTitle">Edit Tags</h2>
                    <button id="closeEditTagsModal" class="modal-close-btn" aria-label="Close modal">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="paper-title-preview" id="editTagsPaperTitle"></p>
                    <div class="global-edit-warning" id="globalEditWarning" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        <span>Global Edit Mode Active - Renaming tags here affects ALL papers</span>
                    </div>
                    <div class="tags-edit-section">
                        <label>Current Tags:</label>
                        <div id="editTagsList" class="edit-tags-list">
                            <!-- Tags will be rendered here -->
                        </div>
                    </div>
                    <div class="tag-input-section">
                        <label for="newTagInput">Add new tag:</label>
                        <div class="tag-input-wrapper">
                            <input type="text" id="newTagInput" class="tag-input" placeholder="Enter tag name" aria-label="Enter new tag name">
                            <button id="addTagBtn" type="button" class="add-tag-btn">+</button>
                        </div>
                        <div id="tagSuggestions" class="tag-suggestions">
                            <span>Suggested: </span>
                            <!-- Suggestions will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Tags Modal -->
        <div id="manageTagsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="manageTagsModalTitle" style="display: none;">
            <div class="modal-container modal-container-large">
                <div class="modal-header">
                    <h2 id="manageTagsModalTitle">Manage Tags</h2>
                    <button id="closeManageTagsModal" class="modal-close-btn" aria-label="Close modal">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="manage-tags-actions">
                        <button id="mergeDuplicateTagsBtn" type="button" class="secondary-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
                            </svg>
                            Merge Duplicate Tags
                        </button>
                    </div>
                    <div id="manageTagsList" class="manage-tags-list">
                        <!-- Tags will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true">
            <!-- Toasts will be rendered here -->
        </div>

        <div id="error" class="error" role="alert" aria-live="assertive" aria-atomic="true"></div>
        <div id="status" class="status" role="status" aria-live="polite"></div>

        <!-- Edit Tags Modal -->
        <div id="editTagsModal" class="modal-overlay" role="dialog" aria-labelledby="editTagsModalTitle" aria-modal="true" style="display: none;">
            <div class="modal-container">
                <div class="modal-header">
                    <h2 id="editTagsModalTitle">Edit Tags</h2>
                    <button type="button" class="modal-close-btn" aria-label="Close modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="paper-title-display" id="editTagsPaperTitle"></p>
                    <div id="globalEditWarning" class="edit-warning" style="display: none;">
                        <span class="warning-icon">⚠️</span>
                        Global Edit Mode Active - Renaming tags affects ALL papers
                    </div>
                    <div class="tags-edit-section">
                        <h3>Current Tags</h3>
                        <div id="currentTagsList" class="current-tags-list"></div>
                    </div>
                    <div class="add-tag-section">
                        <h3>Add New Tag</h3>
                        <div class="tag-input-wrapper">
                            <input type="text" id="newTagInput" class="tag-input" placeholder="Enter tag name" aria-label="Enter new tag name">
                            <button type="button" id="addTagBtn" class="add-tag-btn">Add</button>
                        </div>
                        <div id="tagSuggestions" class="tag-suggestions"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="secondary-btn modal-cancel-btn">Cancel</button>
                    <button type="button" class="modal-save-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- Manage Tags Modal -->
        <div id="manageTagsModal" class="modal-overlay" role="dialog" aria-labelledby="manageTagsModalTitle" aria-modal="true" style="display: none;">
            <div class="modal-container modal-large">
                <div class="modal-header">
                    <h2 id="manageTagsModalTitle">Manage All Tags</h2>
                    <button type="button" class="modal-close-btn" aria-label="Close modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tags-manage-header">
                        <button type="button" id="mergeTagsBtn" class="secondary-btn merge-tags-btn">Merge Duplicate Tags</button>
                    </div>
                    <div id="allTagsList" class="all-tags-list"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="modal-close-btn-footer">Close</button>
                </div>
            </div>
        </div>

        <!-- Rename Tag Modal -->
        <div id="renameTagModal" class="modal-overlay" role="dialog" aria-labelledby="renameTagModalTitle" aria-modal="true" style="display: none;">
            <div class="modal-container modal-small">
                <div class="modal-header">
                    <h2 id="renameTagModalTitle">Rename Tag</h2>
                    <button type="button" class="modal-close-btn" aria-label="Close modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Renaming this tag will affect <strong id="renameTagCount">0</strong> paper(s).</p>
                    <div class="tag-input-wrapper">
                        <input type="text" id="renameTagInput" class="tag-input" aria-label="Enter new tag name">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="secondary-btn modal-cancel-btn">Cancel</button>
                    <button type="button" class="modal-save-btn">Rename</button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications Container -->
        <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

        <footer class="attribution">
            <small>Vibe-coded by Shern Ren Tee with Claude Code + Ollama Cloud GLM 4.7</small>
            <nav class="social-links" aria-label="Social media links">
                <a href="https://github.com/srtee/argonaut" target="_blank" rel="noopener noreferrer" aria-label="View source on GitHub (opens in new tab)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.7 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                    </svg>
                </a>
                <a href="https://www.linkedin.com/in/shern-tee-phd-8172241b3/" target="_blank" rel="noopener noreferrer" aria-label="Connect on LinkedIn (opens in new tab)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                        <rect x="2" y="9" width="4" height="12"></rect>
                        <circle cx="4" cy="4" r="2"></circle>
                    </svg>
                </a>
            </div>
        </footer>
    </main>

    <script src="script.js?v=1.0.4"></script>
</body>
</html>
